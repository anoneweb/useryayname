<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Username Generator with Firebase Auth</title>
  <style>
    /* -- Styles sama seperti sebelumnya supaya konsisten -- */
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, #a2d5f2, #b8f2e6);
      margin: 0; padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 30px 40px;
      border-radius: 12px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      box-sizing: border-box;
    }
    h2 {
      margin-top: 0;
      color: #333;
      user-select: none;
    }
    label {
      font-weight: 700;
      display: block;
      margin: 12px 0 6px;
      user-select: none;
    }
    input[type="text"], input[type="password"], input[type="email"] {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background-color: #0b3d91;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background-color: #084077;
    }
    .error {
      color: #d9534f;
      margin-top: 8px;
      font-weight: 600;
      user-select: none;
    }
    .link-button {
      background: none;
      border: none;
      color: #0b3d91;
      cursor: pointer;
      text-decoration: underline;
      font-size: 1rem;
      margin-top: 14px;
      display: inline-block;
      padding: 0;
      user-select: none;
    }
    .hidden {
      display: none;
    }
    #admin-list {
      max-height: 140px;
      overflow-y: auto;
      margin-top: 14px;
      border: 1.5px solid #c3d0f5;
      padding: 12px 14px;
      border-radius: 8px;
      font-family: monospace;
      background: #f9faff;
      color: #0b3d91;
      white-space: pre-wrap;
      user-select: text;
    }
    /* --- Generator style --- */
    .filter-type {
      margin-bottom: 20px;
      display: flex;
      gap: 26px;
      font-size: 1rem;
      color: #444;
      user-select: none;
    }
    .alphabet-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(38px, 1fr));
      gap: 12px;
      margin-bottom: 32px;
    }
    .alphabet-buttons button {
      background: #e4e9f7;
      border: none;
      border-radius: 8px;
      padding: 11px 0;
      font-weight: 700;
      font-size: 1.15rem;
      color: #0b3d91;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(11, 61, 145, 0.22);
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select: none;
    }
    .alphabet-buttons button:hover {
      background-color: #0b3d91;
      color: #fff;
    }
    .alphabet-buttons button.active {
      background-color: #0b3d91;
      color: #fff;
      box-shadow: 0 4px 12px rgba(11, 61, 145, 0.55);
    }
    .generate {
      width: 100%;
      background: #0b3d91;
      border: none;
      padding: 14px 0;
      color: #fff;
      font-weight: 700;
      font-size: 1.22rem;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(11, 61, 145, 0.6);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .generate:hover {
      background-color: #084077;
    }
    #results {
      margin-top: 30px;
      max-height: 320px;
      overflow-y: auto;
      padding: 22px;
      background: #f5f9ff;
      border-radius: 14px;
      border: 1.5px solid #c3d0f5;
      font-family: 'Courier New', Courier, monospace;
      font-size: 1rem;
      color: #0b3d91;
      user-select: text;
    }
    #results div {
      margin-bottom: 10px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #results strong {
      font-weight: 700;
      white-space: nowrap;
    }
    #results a {
      color: #084077;
      text-decoration: none;
      font-weight: 600;
      word-break: break-word;
      flex-shrink: 0;
    }
    #results a:hover {
      text-decoration: underline;
    }
    /* Scrollbar for results */
    #results::-webkit-scrollbar {
      width: 8px;
    }
    #results::-webkit-scrollbar-thumb {
      background-color: #0b3d91;
      border-radius: 10px;
    }
    /* Responsive */
    @media (max-width: 480px) {
      .container {
        padding: 20px;
        max-width: 360px;
      }
      .filter-type {
        flex-direction: column;
        gap: 14px;
      }
      #results div {
        flex-direction: column;
        align-items: flex-start;
      }
      #results a {
        word-break: break-word;
      }
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

  <!-- User Login Page -->
  <div class="container" id="userLoginPage">
    <h2>Login User</h2>
    <label for="userAccessCodeInput">Masukkan Kode Akses:</label>
    <input type="text" id="userAccessCodeInput" autocomplete="off" />
    <div class="error" id="userLoginError"></div>
    <button id="userLoginBtn">Login</button>
    <button class="link-button" id="goAdminLoginBtn">Masuk Admin</button>
  </div>

  <!-- Admin Login Page -->
  <div class="container hidden" id="adminLoginPage">
    <h2>Login Admin</h2>
    <label for="adminEmailInput">Email Admin:</label>
    <input type="email" id="adminEmailInput" autocomplete="username" />
    <label for="adminPasswordInput">Password:</label>
    <input type="password" id="adminPasswordInput" autocomplete="current-password" />
    <div class="error" id="adminLoginError"></div>
    <button id="adminLoginBtn">Login Admin</button>
    <button class="link-button" id="backToUserLoginBtn">Kembali ke Login User</button>
  </div>

  <!-- Admin Panel -->
  <div class="container hidden" id="adminPanelPage">
    <h2>Admin Panel</h2>
    <label for="newCodeInput">Tambah Kode Akses Baru:</label>
    <input type="text" id="newCodeInput" autocomplete="off" />
    <button id="addCodeBtn">Tambah Kode</button>
    <div class="error" id="adminPanelError"></div>

    <h3>Kode Akses yang Tersedia:</h3>
    <pre id="adminList"></pre>

    <button id="adminLogoutBtn">Logout Admin</button>
  </div>

  <!-- Generator Page -->
  <div class="container hidden" id="generatorPage">
    <h2>PREMIUM USERNAME</h2>
    <label for="baseWordInput">Uername target:</label>
    <input type="text" id="baseWordInput" autocomplete="off" />
    <div class="filter-type">
      <label><input type="radio" name="mode" value="insert" checked /> Sisip Huruf</label>
      <label><input type="radio" name="mode" value="replace" /> Ganti Huruf</label>
    </div>

    <div class="alphabet-buttons" id="alphabetButtons"></div>

    <button id="generateBtn" class="generate">Generate</button>

    <div id="results"></div>

    <button id="userLogoutBtn" style="margin-top:30px; background:#d9534f;">Logout User</button>
  </div>

<script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyATxBuJLruNsx6NZSuvUakUGSgwW1omvr0",
  authDomain: "useryayname-845db.firebaseapp.com",
  projectId: "useryayname-845db",
  storageBucket: "useryayname-845db.firebasestorage.app",
  messagingSenderId: "476857943974",
  appId: "1:476857943974:web:ca932aa4ec60ffaca3b167",
  measurementId: "G-REQRSRGV4X"
};
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  // Halaman dan elemen
  const userLoginPage = document.getElementById('userLoginPage');
  const adminLoginPage = document.getElementById('adminLoginPage');
  const adminPanelPage = document.getElementById('adminPanelPage');
  const generatorPage = document.getElementById('generatorPage');

  const userAccessCodeInput = document.getElementById('userAccessCodeInput');
  const userLoginBtn = document.getElementById('userLoginBtn');
  const userLoginError = document.getElementById('userLoginError');
  const goAdminLoginBtn = document.getElementById('goAdminLoginBtn');

  const adminEmailInput = document.getElementById('adminEmailInput');
  const adminPasswordInput = document.getElementById('adminPasswordInput');
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminLoginError = document.getElementById('adminLoginError');
  const backToUserLoginBtn = document.getElementById('backToUserLoginBtn');

  const newCodeInput = document.getElementById('newCodeInput');
  const addCodeBtn = document.getElementById('addCodeBtn');
  const adminPanelError = document.getElementById('adminPanelError');
  const adminList = document.getElementById('adminList');
  const adminLogoutBtn = document.getElementById('adminLogoutBtn');

  const baseWordInput = document.getElementById('baseWordInput');
  const alphabetButtons = document.getElementById('alphabetButtons');
  const generateBtn = document.getElementById('generateBtn');
  const resultsDiv = document.getElementById('results');
  const userLogoutBtn = document.getElementById('userLogoutBtn');

  // State
  let selectedLetter = null;
  let userLoggedIn = false;
  let adminLoggedIn = false;

  // Fungsi tampilkan halaman
  function showPage(page) {
    [userLoginPage, adminLoginPage, adminPanelPage, generatorPage].forEach(p => p.classList.add('hidden'));
    page.classList.remove('hidden');
  }

  // Buat tombol alphabet a-z
  function renderAlphabetButtons() {
    alphabetButtons.innerHTML = '';
    for(let c=97; c<=122; c++) {
      const ch = String.fromCharCode(c);
      const btn = document.createElement('button');
      btn.textContent = ch;
      btn.addEventListener('click', () => {
        selectedLetter = ch;
        document.querySelectorAll('#alphabetButtons button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
      alphabetButtons.appendChild(btn);
    }
  }

  // --- User login dengan kode akses dari Firestore ---
  userLoginBtn.addEventListener('click', () => {
    const code = userAccessCodeInput.value.trim().toLowerCase();
    userLoginError.textContent = '';
    if (!code) {
      userLoginError.textContent = 'Kode akses harus diisi.';
      return;
    }
    // Cek di Firestore apakah kode ada
    db.collection('accessCodes').where('code', '==', code).get()
      .then(snapshot => {
        if (!snapshot.empty) {
          userLoggedIn = true;
          userAccessCodeInput.value = '';
          renderAlphabetButtons();
          baseWordInput.value = '';
          resultsDiv.innerHTML = '';
          selectedLetter = null;
          showPage(generatorPage);
        } else {
          userLoginError.textContent = 'Kode akses tidak ditemukan.';
        }
      })
      .catch(err => {
        userLoginError.textContent = 'Error: ' + err.message;
      });
  });

  // Pindah ke halaman login admin
  goAdminLoginBtn.addEventListener('click', () => {
    userLoginError.textContent = '';
    userAccessCodeInput.value = '';
    adminLoginError.textContent = '';
    adminEmailInput.value = '';
    adminPasswordInput.value = '';
    showPage(adminLoginPage);
  });

  // --- Login admin dengan Firebase Auth ---
  adminLoginBtn.addEventListener('click', () => {
    const email = adminEmailInput.value.trim();
    const password = adminPasswordInput.value;
    adminLoginError.textContent = '';
    if (!email || !password) {
      adminLoginError.textContent = 'Email dan password harus diisi.';
      return;
    }
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        adminLoggedIn = true;
        renderAdminList();
        newCodeInput.value = '';
        adminPanelError.textContent = '';
        showPage(adminPanelPage);
      })
      .catch(err => {
        adminLoginError.textContent = 'Login gagal: ' + err.message;
      });
  });

  backToUserLoginBtn.addEventListener('click', () => {
    adminLoginError.textContent = '';
    adminEmailInput.value = '';
    adminPasswordInput.value = '';
    showPage(userLoginPage);
  });

  // Render list kode akses dari Firestore
  function renderAdminList() {
    db.collection('accessCodes').get()
      .then(snapshot => {
        if(snapshot.empty) {
          adminList.textContent = '(Belum ada kode akses)';
          return;
        }
        let listText = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          listText += data.code + '\n';
        });
        adminList.textContent = listText.trim();
      })
      .catch(err => {
        adminList.textContent = 'Error: ' + err.message;
      });
  }

  // Tambah kode akses baru ke Firestore
  addCodeBtn.addEventListener('click', () => {
    const newCode = newCodeInput.value.trim().toLowerCase();
    adminPanelError.style.color = '#d9534f'; // default red
    if (!newCode) {
      adminPanelError.textContent = 'Kode akses baru tidak boleh kosong.';
      return;
    }
    // Cek apakah kode sudah ada
    db.collection('accessCodes').where('code', '==', newCode).get()
      .then(snapshot => {
        if (!snapshot.empty) {
          adminPanelError.textContent = 'Kode akses sudah ada.';
          return;
        }
        // Tambah kode baru
        db.collection('accessCodes').add({ code: newCode })
          .then(() => {
            adminPanelError.style.color = '#198754'; // hijau sukses
            adminPanelError.textContent = 'Kode akses berhasil ditambahkan!';
            newCodeInput.value = '';
            renderAdminList();
            setTimeout(() => {
              adminPanelError.textContent = '';
              adminPanelError.style.color = '#d9534f';
            }, 3500);
          })
          .catch(err => {
            adminPanelError.textContent = 'Gagal tambah kode: ' + err.message;
          });
      });
  });

  // Logout admin
  adminLogoutBtn.addEventListener('click', () => {
    auth.signOut().then(() => {
      adminLoggedIn = false;
      showPage(adminLoginPage);
    });
  });

  // Logout user
  userLogoutBtn.addEventListener('click', () => {
    userLoggedIn = false;
    selectedLetter = null;
    showPage(userLoginPage);
  });

  // Generate usernames function (sama dengan sebelumnya)
  function generateUsernames(baseWord, letter, mode) {
    const results = [];
    if (!baseWord || !letter) return results;

    if (mode === 'insert') {
      results.push(letter + baseWord);
      for (let i = 0; i < baseWord.length; i++) {
        results.push(baseWord.slice(0, i + 1) + letter + baseWord.slice(i + 1));
      }
      results.push(baseWord + letter);
    } else if (mode === 'replace') {
      for (let i = 0; i < baseWord.length; i++) {
        let replaced = baseWord.substring(0, i) + letter + baseWord.substring(i + 1);
        results.push(replaced);
      }
    }
    const filtered = [...new Set(results)].filter(r => r !== baseWord);
    return filtered;
  }

  // Render alphabet buttons on generator page load
  function initGenerator() {
    renderAlphabetButtons();
    baseWordInput.value = '';
    resultsDiv.innerHTML = '';
    selectedLetter = null;
  }

  // Generate button click
  generateBtn.addEventListener('click', () => {
    const baseWord = baseWordInput.value.trim().toLowerCase();
    const mode = document.querySelector('input[name="mode"]:checked').value;
    if (!baseWord) {
      alert('Masukkan username yang dituju!');
      baseWordInput.focus();
      return;
    }
    if (!selectedLetter) {
      alert('Pilih huruf filter terlebih dahulu!');
      return;
    }
    const usernames = generateUsernames(baseWord, selectedLetter, mode);
    if (usernames.length === 0) {
      resultsDiv.innerHTML = '<em>Tidak ada hasil yang dihasilkan.</em>';
      return;
    }
    const baseURL = 'https://x.com/';
    resultsDiv.innerHTML = '';
    usernames.forEach(name => {
      const line = document.createElement('div');
      const userSpan = document.createElement('strong');
      userSpan.textContent = '@' + name;

      const link = document.createElement('a');
      link.href = baseURL + name;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.textContent = baseURL + name;

      line.appendChild(userSpan);
      line.appendChild(link);
      resultsDiv.appendChild(line);
    });
  });

  // Saat halaman load, tampilkan halaman login user
  showPage(userLoginPage);
</script>

</body>
</html>
